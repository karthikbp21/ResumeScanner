<% if flash[:alert] %>
  <div class="alert"><%= flash[:alert] %></div>
<% end %>
<div class="container py-5">
  <div class="row mb-4">
    <div class="col-md-8 mx-auto">
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="card-title mb-2 text-primary">Job Posting: Assistant Professor of Physics</h2>
          <p class="mb-1"><strong>Location:</strong> North America</p>
          <p class="mb-1"><strong>Department:</strong> Natural Sciences</p>
          <p class="mb-0"><span class="badge bg-info text-dark">Resumes Uploaded: <%= @resume_count %></span></p>
        </div>
      </div>
    </div>
  </div>

  <div class="row mb-4">
    <div class="col-md-8 mx-auto">
      <div class="input-group mb-2">
        <%= form_tag query_candidates_path, method: :post, class: "w-100 d-flex" do %>
          <%= text_field_tag :prompt, params[:prompt], placeholder: "Ask something like 'Show me all candidates with 5+ years'", class: "form-control me-2" %>
          <%= submit_tag "Search", class: "btn btn-primary" %>
        <% end %>
      </div>
      <div class="d-flex gap-2">
        <%= button_to 'Scan Resumes with AI', scan_resumes_candidates_path, method: :post, class: "btn btn-outline-success" %>
        <%= link_to 'Download Excel', download_excel_candidates_path(format: :xlsx), class: "btn btn-outline-secondary" %>
      </div>
    </div>
  </div>

  <div class="row">
    <div class="col-md-12">
      <div class="card shadow-sm">
        <div class="card-body">
          <h4 class="card-title mb-3">Candidates</h4>
          <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle">
              <thead class="table-light">
                <tr>
                  <th>Name</th>
                  <th>Experience</th>
                  <th>Skills</th>
                  <th>Location</th>
                  <th>Summary</th>
                </tr>
              </thead>
              <tbody>
                <% @candidates.each do |c| %>
                  <tr>
                    <td><%= c.name %></td>
                    <td><%= c.experience_years %> years</td>
                    <td><%= c.skills %></td>
                    <td><%= c.location %></td>
                    <td><%= c.summary.truncate(100) %></td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
